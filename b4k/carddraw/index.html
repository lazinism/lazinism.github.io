<!doctype html>
<html>
	<head>
		<title>Card Drawer</title>
		<meta charset="utf-8">
		<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script src="misc/jquery.flip.min.js"></script>
		<style>
			div.card{
				position: relative;
				width: 125px;
				height: 175px;
				display: inline-block;
				box-shadow: 3px 3px 3px 3px rgba(0, 0, 0, 0.19);
			}
			img{
				user-drag: none; 
				user-select: none;
				-moz-user-select: none;
				-webkit-user-drag: none;
				-webkit-user-select: none;
				-ms-user-select: none;
			}
			#options{
				position:fixed;
				bottom:10px;
				width:100%;				
			}
			img.cardimg{
				width:125px;
				height:175px;
			}
			#b4card_placements{
				cursor: url(misc/cursor.png), auto;
			}
			body{
				background-image: url('misc/bg.jpg');
			}
		</style>
		<script>
			var cardData;
			Array.prototype.remove = function() {
				var what, a = arguments, L = a.length, ax;
				while (L && this.length) {
					what = a[--L];
					while ((ax = this.indexOf(what)) !== -1) {
						this.splice(ax, 1);
					}
				}
				return this;
			};
			$(document).ready(function(){
				for(i=0;i<6;i++){
					$('#card_' + i).flip({speed:1000});
				}
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open("GET", "main/cards.json",false);
				xmlhttp.send(null);
				cardData = JSON.parse(xmlhttp.responseText);
				reset();
			});
			function setcard(num){
				for(i=0;i<6;i++){
					$('#card_'+i).attr('current', 'front');
					if(i<num) $('#card_'+i).show();
					else $('#card_'+i).hide();
					$('#card_'+i).flip(false);
				}
				switch(num){
					case 1:
						$("#card_0").css('left', '50%');
						$("#card_0").css('top', '30%');
						$("body").css("background-image", "url(misc/bg1.jpg");
						break;
					case 2:
						$("#card_0").css('left', '48%');
						$("#card_0").css('top', '30%');
						$("#card_1").css('left', '52%');
						$("#card_1").css('top', '30%');
						$("body").css("background-image", "url(misc/bg2.jpg");
						break;
					case 3:
						$("#card_0").css('left', '48%');
						$("#card_0").css('top', '35%');
						$("#card_1").css('left', '52%');
						$("#card_1").css('top', '35%');
						$("#card_2").css('left', '40%');
						$("#card_2").css('top', '5%');
						$("body").css("background-image", "url(misc/bg3.jpg");
						break;
					case 4:
						$("#card_0").css('left', '48%');
						$("#card_0").css('top', '35%');
						$("#card_1").css('left', '52%');
						$("#card_1").css('top', '35%');
						$("#card_2").css('left', '35%');
						$("#card_2").css('top', '5%');
						$("#card_3").css('left', '38%');
						$("#card_3").css('top', '5%');
						$("body").css("background-image", "url(misc/bg4.jpg");
						break;
					case 5:
						$("#card_0").css('left', '41%');
						$("#card_0").css('top', '35%');
						$("#card_1").css('left', '47%');
						$("#card_1").css('top', '35%');
						$("#card_2").css('left', '53%');
						$("#card_2").css('top', '35%');
						$("#card_3").css('left', '25%');
						$("#card_3").css('top', '5%');
						$("#card_4").css('left', '34%');
						$("#card_4").css('top', '5%');
						$("body").css("background-image", "url(misc/bg5.jpg");
						break;
					case 6:
						$("#card_0").css('left', '41%');
						$("#card_0").css('top', '35%');
						$("#card_1").css('left', '47%');
						$("#card_1").css('top', '35%');
						$("#card_2").css('left', '53%');
						$("#card_2").css('top', '35%');
						$("#card_3").css('left', '21%');
						$("#card_3").css('top', '5%');
						$("#card_4").css('left', '27%');
						$("#card_4").css('top', '5%');
						$("#card_5").css('left', '33%');
						$("#card_5").css('top', '5%');
						$("body").css("background-image", "url(misc/bg6.jpg");
				}
			}
			function randomCard(){
				itData = JSON.parse(JSON.stringify(cardData));
				for(i=0;i<6;i++){
					dataLength = itData.length;
					rand = Math.floor(Math.random()*(dataLength-1))
					data = itData[rand];
					$("#card_"+i).attr("rank", data.rank);
					$('#card_'+i).children(".back").children('img').attr('src', 'main/'+data.file)
					itData.remove(data);
				}
			}
			function reversethis(num){
				$('#card_'+num).flip();
				if($('#card_'+num).attr('current')=="front"){
					$('#card_'+num).attr('current', 'back');
					if ($('#card_'+num).attr('rank')=="E") $('#audio_'+num).attr('src', 'misc/E.mp3');
					else if ($('#card_'+num).attr('rank')=="D") $('#audio_'+num).attr('src', 'misc/D.mp3');
					else if ($('#card_'+num).attr('rank')=="B") $('#audio_'+num).attr('src', 'misc/B.mp3');
					else if ($('#card_'+num).attr('rank')=="C") $('#audio_'+num).attr('src', 'misc/E.mp3');
					else $('#audio_'+num).attr('src', 'misc/A.mp3');
					$('#audio_'+num).trigger('play');
				}
				else $('#card_'+num).attr('current', 'front');
			}
			function reset(){
				setcard(6);/*
				for(i=0;i<6;i++){
					$('#card_'+i).children(".back").children('img').attr('src', "https://via.placeholder.com/125x175");
				}*/
			}
			function mouseevent(e){
				switch(e){
					case 0:
					$("#b4card_placements").css('cursor', 'url(misc/ccursor.png), auto');
					break;
					case 1:
					$("#b4card_placements").css('cursor', 'url(misc/cursor.png), auto');
					break;
					default:
					$("#b4card_placements").css('cursor', 'url(misc/cursor.png), auto');
				}
			}
		</script>
	</head>
	<body>
		<div id="b4card_placements" style="width: 100vw;height:90vh" onmousedown="mouseevent(0);" onmouseup="mouseevent(1);">
			<div id="card_0" class="card" current="front" rank="E">
				<div class="front"><img class='cardimg' src="misc/back.png" onclick="reversethis(0)"></div>
				<div class="back"><img class='cardimg' src="https://via.placeholder.com/125x175" onclick="reversethis(0)"></div>
			</div>
			<div id="card_1" class="card" current="front" rank="E">
				<div class="front"><img class='cardimg' src="misc/back.png" onclick="reversethis(1)"></div>
				<div class="back"><img class='cardimg' src="https://via.placeholder.com/125x175" onclick="reversethis(1)"></div>
			</div>
			<div id="card_2" class="card" current="front" rank="E">
				<div class="front"><img class='cardimg' src="misc/back.png" onclick="reversethis(2)"></div>
				<div class="back"><img class='cardimg' src="https://via.placeholder.com/125x175" onclick="reversethis(2)"></div>
			</div>
			<div id="card_3" class="card" current="front" rank="E">
				<div class="front"><img class='cardimg' src="misc/back.png" onclick="reversethis(3)"></div>
				<div class="back"><img class='cardimg' src="https://via.placeholder.com/125x175" onclick="reversethis(3)"></div>
			</div>
			<div id="card_4" class="card" current="front" rank="E">
				<div class="front"><img class='cardimg' src="misc/back.png" onclick="reversethis(4)"></div>
				<div class="back"><img class='cardimg' src="https://via.placeholder.com/125x175" onclick="reversethis(4)"></div>
			</div>
			<div id="card_5" class="card" current="front" rank="E">
				<div class="front"><img class='cardimg' src="misc/back.png" onclick="reversethis(5)"></div>
				<div class="back"><img class='cardimg' src="https://via.placeholder.com/125x175" onclick="reversethis(5)"></div>
			</div>
		</div>
		<div id="options">
			<div>
				카드 갯수 : 
				<button type="button" onclick="setcard(1);">1</button>
				<button type="button" onclick="setcard(2);">2</button>
				<button type="button" onclick="setcard(3);">3</button>
				<button type="button" onclick="setcard(4);">4</button>
				<button type="button" onclick="setcard(5);">5</button>
				<button type="button" onclick="setcard(6);">6</button>
			</div>
			<div>
				<button type="button" onclick="reset();">리셋</button>
				<button type="button" onclick="randomCard();">카드 배정</button>
			</div>
			<div id="test"></div>
 		</div>
		<div style="display:none;">
			<audio id="audio_0" autostart="false"></audio>
			<audio id="audio_1" autostart="false"></audio>
			<audio id="audio_2" autostart="false"></audio>
			<audio id="audio_3" autostart="false"></audio>
			<audio id="audio_4" autostart="false"></audio>
			<audio id="audio_5" autostart="false"></audio>
		</div>
	</body>
</html>